<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metal Lab - Working Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100vh;
        }

        #sidebar {
            width: 320px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #4CAF50;
        }

        #viewport {
            flex: 1;
            position: relative;
        }

        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #4CAF50;
            text-align: center;
        }

        h2 {
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #00d4ff;
        }

        .demo-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .demo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .controls {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
        }

        .value-display {
            color: #4CAF50;
            font-weight: bold;
            float: right;
        }

        .action-btn {
            padding: 10px 20px;
            margin: 5px;
            background: #4CAF50;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .action-btn:hover {
            background: #45a049;
        }

        .action-btn.reset {
            background: #f44336;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 8px;
            min-width: 250px;
            border: 2px solid #00d4ff;
        }

        #info-panel h3 {
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            color: #4CAF50;
            font-weight: bold;
        }

        .description {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 200, 255, 0.1);
            border-left: 3px solid #00d4ff;
            font-size: 12px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <h1>üß™ Metal Lab</h1>
            <p style="text-align: center; color: #aaa; font-size: 12px; margin-bottom: 20px;">
                Interactive Physics Demos
            </p>

            <h2>Available Demos</h2>
            <button class="demo-btn active" data-demo="pendulum">Simple Pendulum</button>
            <button class="demo-btn" data-demo="particles">Particle System</button>
            <button class="demo-btn" data-demo="waves">Wave Interference</button>
            <button class="demo-btn" data-demo="orbit">Orbital Motion</button>

            <div class="controls">
                <h2 style="margin-top: 0;">Controls</h2>
                <button class="action-btn" id="start-btn">‚ñ∂Ô∏è Start</button>
                <button class="action-btn" id="pause-btn">‚è∏Ô∏è Pause</button>
                <button class="action-btn reset" id="reset-btn">üîÑ Reset</button>
            </div>

            <div id="parameter-controls">
                <h2>Parameters</h2>
                <div class="control-group">
                    <label>
                        Length: <span class="value-display" id="length-value">10.0 m</span>
                    </label>
                    <input type="range" id="length-slider" min="5" max="30" value="10" step="0.5">
                </div>
                <div class="control-group">
                    <label>
                        Gravity: <span class="value-display" id="gravity-value">9.81 m/s¬≤</span>
                    </label>
                    <input type="range" id="gravity-slider" min="1" max="20" value="9.81" step="0.1">
                </div>
                <div class="control-group">
                    <label>
                        Damping: <span class="value-display" id="damping-value">0.99</span>
                    </label>
                    <input type="range" id="damping-slider" min="0.9" max="1" value="0.99" step="0.01">
                </div>
            </div>

            <div class="description">
                <strong>Enhanced Features:</strong><br>
                ‚Ä¢ Realistic physics simulation<br>
                ‚Ä¢ Interactive parameter control<br>
                ‚Ä¢ Real-time visualization<br>
                ‚Ä¢ 60 FPS performance
            </div>
        </div>

        <div id="viewport">
            <canvas id="canvas"></canvas>

            <div id="info-panel">
                <h3>Simulation Stats</h3>
                <div class="stat-item">
                    <span class="stat-label">Status:</span>
                    <span class="stat-value" id="status">Ready</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Time:</span>
                    <span class="stat-value" id="time">0.0 s</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">FPS:</span>
                    <span class="stat-value" id="fps">60</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Objects:</span>
                    <span class="stat-value" id="objects">0</span>
                </div>
            </div>
        </div>
    </div>

    <script src="three.min.js"></script>
    <script>
        // Three.js scene setup
        const canvas = document.getElementById('canvas');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });

        renderer.setSize(canvas.offsetWidth, canvas.offsetHeight);
        renderer.setClearColor(0x1a1a2e);
        renderer.shadowMap.enabled = true;

        camera.position.set(0, 5, 15);
        camera.lookAt(0, 0, 0);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 10, 10);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        const pointLight = new THREE.PointLight(0x00d4ff, 0.5);
        pointLight.position.set(-10, 5, -10);
        scene.add(pointLight);

        // Grid helper
        const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
        scene.add(gridHelper);

        // Simple Pendulum Demo
        class SimplePendulum {
            constructor() {
                this.length = 10;
                this.angle = 0.3;
                this.angularVel = 0;
                this.gravity = 9.81;
                this.damping = 0.99;
                this.trailPoints = [];

                this.setupMeshes();
            }

            setupMeshes() {
                // Pivot point
                const pivotGeom = new THREE.SphereGeometry(0.2, 16, 16);
                const pivotMat = new THREE.MeshStandardMaterial({
                    color: 0x888888,
                    metalness: 0.8,
                    roughness: 0.2
                });
                this.pivot = new THREE.Mesh(pivotGeom, pivotMat);
                this.pivot.position.y = this.length;
                scene.add(this.pivot);

                // Bob
                const bobGeom = new THREE.SphereGeometry(0.3, 32, 32);
                const bobMat = new THREE.MeshStandardMaterial({
                    color: 0xb87333,
                    metalness: 0.8,
                    roughness: 0.3
                });
                this.bob = new THREE.Mesh(bobGeom, bobMat);
                this.bob.castShadow = true;
                this.bob.receiveShadow = true;
                scene.add(this.bob);

                // String (cylinder)
                const stringGeom = new THREE.CylinderGeometry(0.02, 0.02, this.length, 8);
                const stringMat = new THREE.MeshStandardMaterial({
                    color: 0xcccccc,
                    metalness: 0.6,
                    roughness: 0.4
                });
                this.string = new THREE.Mesh(stringGeom, stringMat);
                scene.add(this.string);

                // Trail
                const trailGeom = new THREE.BufferGeometry();
                const trailMat = new THREE.LineBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.6
                });
                this.trail = new THREE.Line(trailGeom, trailMat);
                scene.add(this.trail);

                // Pointer
                const pointerGeom = new THREE.ConeGeometry(0.08, 0.4, 16);
                const pointerMat = new THREE.MeshStandardMaterial({
                    color: 0xff0000,
                    emissive: 0xff0000,
                    emissiveIntensity: 0.5
                });
                this.pointer = new THREE.Mesh(pointerGeom, pointerMat);
                this.pointer.rotation.x = Math.PI;
                this.bob.add(this.pointer);
            }

            update(dt) {
                // Simple pendulum physics: Œ∏'' = -(g/L) * sin(Œ∏)
                const angularAcc = -(this.gravity / this.length) * Math.sin(this.angle);
                this.angularVel += angularAcc * dt;
                this.angularVel *= this.damping; // Apply damping
                this.angle += this.angularVel * dt;

                // Update bob position
                const x = this.length * Math.sin(this.angle);
                const y = this.length * Math.cos(this.angle);
                this.bob.position.set(x, this.length - y, 0);

                // Update string
                const pivot = new THREE.Vector3(0, this.length, 0);
                const bobPos = this.bob.position.clone();
                const stringDir = new THREE.Vector3().subVectors(bobPos, pivot).normalize();
                const up = new THREE.Vector3(0, -1, 0);
                const quaternion = new THREE.Quaternion().setFromUnitVectors(up, stringDir);

                this.string.position.copy(pivot).add(bobPos).multiplyScalar(0.5);
                this.string.quaternion.copy(quaternion);

                // Update trail
                this.trailPoints.push(this.bob.position.clone());
                if (this.trailPoints.length > 500) {
                    this.trailPoints.shift();
                }
                this.trail.geometry.setFromPoints(this.trailPoints);
            }

            setLength(length) {
                this.length = length;
                this.pivot.position.y = length;
            }

            setGravity(gravity) {
                this.gravity = gravity;
            }

            setDamping(damping) {
                this.damping = damping;
            }

            reset() {
                this.angle = 0.3;
                this.angularVel = 0;
                this.trailPoints = [];
                this.trail.geometry.setFromPoints([]);
            }

            dispose() {
                scene.remove(this.pivot);
                scene.remove(this.bob);
                scene.remove(this.string);
                scene.remove(this.trail);
            }
        }

        // State
        let currentDemo = null;
        let isRunning = false;
        let startTime = Date.now();
        let elapsedTime = 0;
        let frameCount = 0;
        let lastTime = Date.now();

        // Initialize first demo
        function initDemo(demoType) {
            if (currentDemo) {
                currentDemo.dispose();
            }

            if (demoType === 'pendulum') {
                currentDemo = new SimplePendulum();
            }
            // Add other demos here
        }

        initDemo('pendulum');

        // Controls
        document.getElementById('start-btn').addEventListener('click', () => {
            isRunning = true;
            document.getElementById('status').textContent = 'Running';
        });

        document.getElementById('pause-btn').addEventListener('click', () => {
            isRunning = false;
            document.getElementById('status').textContent = 'Paused';
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            if (currentDemo) {
                currentDemo.reset();
            }
            elapsedTime = 0;
            frameCount = 0;
            document.getElementById('time').textContent = '0.0 s';
        });

        // Parameter controls
        document.getElementById('length-slider').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById('length-value').textContent = value.toFixed(1) + ' m';
            if (currentDemo && currentDemo.setLength) {
                currentDemo.setLength(value);
            }
        });

        document.getElementById('gravity-slider').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById('gravity-value').textContent = value.toFixed(2) + ' m/s¬≤';
            if (currentDemo && currentDemo.setGravity) {
                currentDemo.setGravity(value);
            }
        });

        document.getElementById('damping-slider').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById('damping-value').textContent = value.toFixed(2);
            if (currentDemo && currentDemo.setDamping) {
                currentDemo.setDamping(value);
            }
        });

        // Demo selection
        document.querySelectorAll('.demo-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                initDemo(btn.dataset.demo);
            });
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            const currentTime = Date.now();
            const dt = Math.min((currentTime - lastTime) / 1000, 0.1); // Max 0.1s timestep
            lastTime = currentTime;

            if (isRunning && currentDemo) {
                currentDemo.update(dt);
                elapsedTime += dt;
                frameCount++;

                // Update stats
                document.getElementById('time').textContent = elapsedTime.toFixed(1) + ' s';
                if (frameCount % 60 === 0) {
                    const fps = Math.round(1 / dt);
                    document.getElementById('fps').textContent = fps;
                }
            }

            // Camera orbit
            const time = Date.now() * 0.0001;
            camera.position.x = Math.sin(time) * 15;
            camera.position.z = Math.cos(time) * 15;
            camera.lookAt(0, 5, 0);

            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        });

        // Start animation
        animate();

        console.log('üß™ Metal Lab Demo Ready!');
        console.log('‚ú® Enhanced experiments with realistic physics');
        console.log('üéÆ Interactive controls and real-time visualization');
    </script>
</body>
</html>
